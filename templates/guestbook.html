{% extends "base.html" %}

{% block title %}Guestbook{% endblock %}

{% block content %}
<div class="fade-in">
  <h1>Guestbook</h1>

  <form method="get" style="margin-bottom:12px;">
    <input name="q" value="{{ q }}" placeholder="Search name or message" />
    <button type="submit">Search</button>
  </form>

  {% if error %}
    <div style="background:#ffe8e8; color:#a00; padding:10px; border-radius:8px; margin-bottom:12px;">
      {{ error }}
    </div>
  {% endif %}

  <form method="post" style="display:grid; gap:10px; max-width:420px;">
    <input name="name" placeholder="Your name" required />
    <textarea name="message" placeholder="Your message" rows="3" required></textarea>
    <button type="submit">Add Entry</button>
  </form>

  <h2 style="margin-top:20px;">Latest entries</h2>
  <div style="display:grid; gap:12px;">
    {% for id, name, message, created_at in entries %}
      <div style="background:#fff; padding:14px 16px; border-radius:10px; box-shadow:0 4px 16px rgba(0,0,0,.06); display:grid; gap:8px;">
        <div><strong>{{ name }}</strong> <span style="color:#666;font-size:12px;">• {{ created_at }}</span></div>
        <div>{{ message }}</div>
        <div style="display:flex; gap:8px;">
          <a href="/guestbook/{{ id }}/edit">Edit</a>
          <form action="/guestbook/{{ id }}/delete{% if q %}?q={{ q }}{% endif %}" method="post" onsubmit="return confirm('Delete this entry?');">
            <button type="submit">Delete</button>
          </form>
        </div>
      </div>
    {% else %}
      <div>No entries yet — be the first! 💛</div>
    {% endfor %}
  </div>

  <div style="margin-top:14px; display:flex; gap:10px; align-items:center;">
    {% if page > 1 %}
      <a href="?page={{ page-1 }}&limit={{ limit }}{% if q %}&q={{ q }}{% endif %}">← Prev</a>
    {% endif %}
    <span>Page {{ page }} / {{ total_pages }}</span>
    {% if page < total_pages %}
      <a href="?page={{ page+1 }}&limit={{ limit }}{% if q %}&q={{ q }}{% endif %}">Next →</a>
    {% endif %}
    <a href="/guestbook/export" style="margin-left:auto;">Export CSV</a>
  </div>
</div>
{% endblock %}
